<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>WeiBai Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="title: 我的第一篇文章date: 2024-03-17 09:07:15tags: none 使用 acme.sh 脚本，在Linux服务器上免费申请 TSL&#x2F;SSL 域名证书如何安装 acme.sh安装很简单, 一个命令： &#109;&#x79;&#x40;&#x65;&#x78;&#x61;&#109;&#x70;&#x6c;&#101;&#46;&#99;&#x6f;&amp;#">
<meta property="og:type" content="article">
<meta property="og:title" content="WeiBai Blog">
<meta property="og:url" content="https://mengbailuoli233.github.io/2024/03/17/My-New-Post/index.html">
<meta property="og:site_name" content="WeiBai Blog">
<meta property="og:description" content="title: 我的第一篇文章date: 2024-03-17 09:07:15tags: none 使用 acme.sh 脚本，在Linux服务器上免费申请 TSL&#x2F;SSL 域名证书如何安装 acme.sh安装很简单, 一个命令： &#109;&#x79;&#x40;&#x65;&#x78;&#x61;&#109;&#x70;&#x6c;&#101;&#46;&#99;&#x6f;&amp;#">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-03-17T01:07:15.371Z">
<meta property="article:modified_time" content="2024-03-17T01:14:30.781Z">
<meta property="article:author" content="WeiBai">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="WeiBai Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">WeiBai Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">「这里是 WeiBai 的个人博客，希望能给你一些帮助 | 你若盛开，清风自来」</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://mengbailuoli233.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-My-New-Post" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/17/My-New-Post/" class="article-date">
  <time class="dt-published" datetime="2024-03-17T01:07:15.371Z" itemprop="datePublished">2024-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <hr>
<p>title: 我的第一篇文章<br>date: 2024-03-17 09:07:15<br>tags: none</p>
<p>使用 acme.sh 脚本，在Linux服务器上免费申请 TSL&#x2F;SSL 域名证书<br>如何安装 acme.sh<br>安装很简单, 一个命令：</p>
<p><a href="mailto:&#109;&#x79;&#x40;&#x65;&#x78;&#x61;&#109;&#x70;&#x6c;&#101;&#46;&#99;&#x6f;&#x6d;">&#109;&#x79;&#x40;&#x65;&#x78;&#x61;&#109;&#x70;&#x6c;&#101;&#46;&#99;&#x6f;&#x6d;</a>替换成你的Email电子邮箱。</p>
<p>curl <a target="_blank" rel="noopener" href="https://get.acme.sh/">https://get.acme.sh</a> | sh -s email&#x3D;<a href="mailto:&#109;&#121;&#64;&#x65;&#120;&#97;&#x6d;&#112;&#108;&#101;&#x2e;&#99;&#x6f;&#x6d;">&#109;&#121;&#64;&#x65;&#120;&#97;&#x6d;&#112;&#108;&#101;&#x2e;&#99;&#x6f;&#x6d;</a><br>将脚本下载到服务器安装：</p>
<p>wget -O -  <a target="_blank" rel="noopener" href="https://get.acme.sh/">https://get.acme.sh</a> | sh -s email&#x3D;<a href="mailto:&#x6d;&#121;&#64;&#101;&#120;&#97;&#x6d;&#112;&#x6c;&#x65;&#46;&#x63;&#111;&#109;">&#x6d;&#121;&#64;&#101;&#120;&#97;&#x6d;&#112;&#x6c;&#x65;&#46;&#x63;&#111;&#109;</a><br>或者，从 git 安装，克隆此项目并启动安装：</p>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/acmesh-official/acme.sh.git">https://github.com/acmesh-official/acme.sh.git</a><br>cd .&#x2F;acme.sh<br>.&#x2F;acme.sh –install -m <a href="mailto:&#109;&#121;&#64;&#x65;&#x78;&#x61;&#109;&#112;&#x6c;&#101;&#46;&#x63;&#x6f;&#x6d;">&#109;&#121;&#64;&#x65;&#x78;&#x61;&#109;&#112;&#x6c;&#101;&#46;&#x63;&#x6f;&#x6d;</a><br>安装程序将执行 3 个操作：</p>
<p>创建并复制到您的主页目录： 所有证书也将放在此文件夹中。acme.sh$HOME~&#x2F;.acme.sh&#x2F;</p>
<p>为以下内容创建别名：acme.sh&#x3D;~&#x2F;.acme.sh&#x2F;acme.sh</p>
<p>创建每日 cron 作业以根据需要检查和续订证书。</p>
<p>配置 acme.sh 脚本<br>普通用户和 root 用户都可以进行 acme.sh 安装使用。<br>安装过程进行了以下几步:<br>把 acme.sh 安装到你的 home 目录下:~&#x2F;.acme.sh&#x2F;并创建 一个 bash 的 alias,方便你的使用:</p>
<p>alias acme.sh&#x3D;<del>&#x2F;.acme.sh&#x2F;acme.sh<br>echo ‘alias acme.sh&#x3D;</del>&#x2F;.acme.sh&#x2F;acme.sh’ &gt;&gt;&#x2F;etc&#x2F;profile<br>安装过程中会自动为你创建 cronjob, 每天 0:00 点自动检测所有的证书,如果快过期了,需要更新,则会自动更新证书。</p>
<p>00 00 * * * root &#x2F;root&#x2F;.acme.sh&#x2F;acme.sh –cron –home &#x2F;root&#x2F;.acme.sh &amp;&gt;&#x2F;var&#x2F;log&#x2F;acme.sh.logs<br>更高级的安装选项请参考:<br><a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh/wiki/How-to-install">https://github.com/Neilpang/acme.sh/wiki/How-to-install</a><br>在该脚本的安装过程不会污染已有的系统任何功能和文件,所有的修改都限制在安装目录中: ~&#x2F;.acme.sh&#x2F;</p>
<p>高级安装<br>git clone –depth 1 <a target="_blank" rel="noopener" href="https://github.com/acmesh-official/acme.sh.git">https://github.com/acmesh-official/acme.sh.git</a><br>cd acme.sh<br>.&#x2F;acme.sh –install  <br>–home ~&#x2F;myacme <br>–config-home ~&#x2F;myacme&#x2F;data <br>–cert-home  ~&#x2F;mycerts <br>–accountemail  “<a href="mailto:&#109;&#121;&#x40;&#x65;&#120;&#x61;&#109;&#112;&#108;&#101;&#46;&#x63;&#111;&#x6d;">&#109;&#121;&#x40;&#x65;&#120;&#x61;&#109;&#112;&#108;&#101;&#46;&#x63;&#111;&#x6d;</a>“ <br>–accountkey  ~&#x2F;myaccount.key <br>–accountconf ~&#x2F;myaccount.conf <br>–useragent  “this is my client.”<br>您不需要全部设置，只需设置您关心的那些即可。</p>
<p>说明：</p>
<p>–home是要安装的自定义目录acme.sh。默认情况下，它安装到~&#x2F;.acme.sh</p>
<p>–config-home是一个可写文件夹，acme.sh<br>将在其中写入所有文件（包括证书&#x2F;密钥、配置）。默认情况下，它位于–home</p>
<p>–cert-home是一个自定义目录，用于保存您颁发的证书。默认情况下，它保存在–config-home.</p>
<p>–accountemail是用于注册 Let’s Encrypt<br>帐户的电子邮件，您将在此处收到续订通知电子邮件。</p>
<p>–accountkey是保存您的帐户私钥的文件。默认情况下，它保存在–config-home.</p>
<p>–useragent 是用于发送到 Let’s Encrypt 的用户代理标头值。</p>
<p>–nocron安装 acme.sh 而不使用 cronjob</p>
<p>使用 acme.sh 申请证书<br>acme.sh 实现了 acme 协议支持的所有验证协议. 一般有两种方式验证: http 和 dns 验证。</p>
<p>HTTP 方式<br>http 方式需要在你的网站根目录下放置一个文件,来验证你的域名所有权,完成验证. 然后就可以生成证书了。</p>
<p>下面以域名test.com为例：</p>
<p>acme.sh –issue -d test.com -d *.test.com –webroot &#x2F;www&#x2F;wwwroot&#x2F;test.com&#x2F;<br>只需要指定域名，并指定域名所在的网站根目录. acme.sh 会全自动的生成验证文件，并放到网站的根目录，然后自动完成验证。最后会聪明的删除验证文件，整个过程没有任何副作用。<br>如果你用的 apache服务器，acme.sh 还可以智能的从apache的配置中自动完成验证，你不需要指定网站根目录：</p>
<p>acme.sh –issue -d test.com –test.com<br>如果你用的nginx服务器，或者反代, acme.sh还可以智能的从nginx的配置中自动完成验证，你不需要指定网站根目录：</p>
<p>acme.sh –issue -d test.com –nginx<br>注意：无论是 apache 还是 nginx 模式，acme.sh在完成验证之后，会恢复到之前的状态，都不会私自更改你本身的配置。好处是你不用担心配置被搞坏。该类型的配置有一个缺点，你需要自己配置 ssl 的配置，否则只能成功生成证书，你的网站还是无法访问https，但是为了安全，你还是自己手动改配置吧。如果你还没有运行任何 web 服务，80 端口是空闲的，那么 acme.sh 还能假装自己是一个 webserver，临时听在80 端口，完成验证：</p>
<p>acme.sh –issue -d test.com –standalone<br>DNS方式<br>这种方式的好处是，你不需要任何服务器，不需要任何公网 ip，只需要 dns 的解析记录即可完成验证。<br>这种方式的缺点是，如果不同时配置 Automatic DNS API，使用这种方式 acme.sh 将无法自动更新证书，每次都需要手动再次重新解析验证域名所有权。</p>
<p>DNS方式申请证书<br>cd &#x2F;root&#x2F;.acme.sh<br>acme.sh –issue -d *.test.com -d test.com –dns –yes-I-know-dns-manual-mode-enough-go-ahead-please<br>修改DNS，在NS管理方修改主机记录。</p>
<p>DNS方式生成证书<br>获取Let’s Encrypt免费泛域名证书。等待DNS解析生效后，运行以下命令重新生成证书：</p>
<p>acme.sh –renew -d *.test.com -d test.com –dns –yes-I-know-dns-manual-mode-enough-go-ahead-please<br>注意第二次这里用的是 –renew</p>
<p>dns 方式API<br>dns 方式的真正强大之处在于可以使用域名解析商提供的 api 自动添加 txt 记录完成验证。<br>acme.sh 目前支持 cloudflare、dnspod、cloudxns、godaddy 以及 ovh 等数十种解析商的自动集成。<br>以 dnspod 为例, 你需要先登录到 dnspod 账号，生成你的 api id 和 api key ，都是免费的。</p>
<p>export DP_Id&#x3D;”xxxxxxxxxxx”<br>export DP_Key&#x3D;”xxxxxxxxxxxxxx”<br>acme.sh –issue –dns dns_dp -d test.com -d <a target="_blank" rel="noopener" href="http://www.test.com/">www.test.com</a><br>证书就会自动生成了. 这里给出的 api id 和 api key 会被自动记录下来, 将来你在使用 dnspod api 的时候, 就不需要再次指定了. 直接生成就好了:</p>
<p>acme.sh –issue -d test.com –dns dns_dp<br>更详细的 api 用法:<a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md">https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md</a></p>
<p>TLS&#x2F;SSL 证书的使用<br>TLS&#x2F;SSL证书安装<br>前面证书生成以后, 接下来需要把证书 copy 到真正需要用它的地方。</p>
<p>注意, 默认生成的证书都放在安装目录下: ~&#x2F;.acme.sh&#x2F;,请不要直接使用此目录下的文件,例如: 不要直接让 nginx&#x2F;apache 的配置文件使用这下面的文件.这里面的文件都是内部使用,而且目录结构可能会变化. 正确的使用方法是使用 –installcert 命令,并指定目标位置, 然后证书文件会被copy到相应的位置, 例如:</p>
<p>acme.sh –installcert -d test.com <br>–key-file &#x2F;etc&#x2F;nginx&#x2F;ssl&#x2F;test.key <br>–fullchain-file &#x2F;etc&#x2F;nginx&#x2F;ssl&#x2F;fullchain.cer <br>–reloadcmd “systemctl force-reload nginx”<br>Nginx服务器安装SSL证书<br>例如：以Nginx标准配置为例，生成的证书文件推荐使用 fullchain.cer，私钥文件为是 test.com.key。</p>
<p>Nginx 的配置 ssl_certificate 使用 fullchain.cer ，而非 .cer，否则 SSL Labs 的测试会报 Chain issues Incomplete 错误。通过上述中生成的证书路径为&#x2F;www&#x2F;server&#x2F;panel&#x2F;vhost&#x2F;cert&#x2F;test.com&#x2F;；修改Nginx的配置文件</p>
<p>server {<br>listen 443;<br>erver_name test.com;<br>ssl on;<br>root html;<br>index index.html index.htm;<br>ssl_certificate &#x2F;www&#x2F;server&#x2F;panel&#x2F;vhost&#x2F;cert&#x2F;test.com&#x2F;fullchain.cer;<br>ssl_certificate_key &#x2F;www&#x2F;server&#x2F;panel&#x2F;vhost&#x2F;cert&#x2F;test.com&#x2F;clsn.key;<br>ssl_session_timeout 5m;<br>ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;<br>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;<br>ssl_prefer_server_ciphers on;<br>location &#x2F; {<br>root html;<br>index index.html index.htm;<br>}<br>}<br>重启nginx，加载新配置</p>
<p>systemctl force-reload nginx<br>注意：这里用的是systemctl force-reload nginx，不是systemctl reload nginx，reload 并不会重新加载证书，所以用的 force-reload。</p>
<p>更新证书<br>证书的更新<br>目前证书有效期是90天，在60天以后会通过定时任务自动更新，你无需任何操作。都是自动的，你不用担心证书失效的问题。</p>
<p>acme.sh 更新<br>目前由于 acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也经常更新以保持同步.升级 acme.sh 到最新版 :</p>
<p>acme.sh –upgrade<br>如果你不想手动升级, 可以开启自动升级:</p>
<p>acme.sh –upgrade –auto-upgrade<br>之后, acme.sh 就会自动保持更新了.你也可以随时关闭自动更新:</p>
<p>acme.sh –upgrade –auto-upgrade 0<br>acme.sh脚本使用新cloudflare api令牌申请证书<br>备注：本文是将原作者的两种申请cloudflare证书的方式合在一起，即用global API和局部 API两种。</p>
<p>前言：acme.sh是一个非常好用的用来申请证书的脚本，它开源在Github，它极大地降低了申请证书的难度，支持使用cloudflare api等众多api来申请证书。</p>
<p>本文主要介绍使用此脚本来申请ssl证书，给你的http请求加把锁，具体会使用cloudflare api来介绍。</p>
<p>准备条件：一台被分配了公网IP的主机、一个域名(建议购买收费域名)、电脑ssh客户端、能解决遇到问题的个体</p>
<p>Global API申请证书部份<br>安装脚本文件<br>apt update &amp;&amp; apt -y install socat &#x2F;&#x2F;更新源并安装socat</p>
<p>wget -qO- get.acme.sh | bash &#x2F;&#x2F;安装此脚本</p>
<p>source ~&#x2F;.bashrc &#x2F;&#x2F;让别名生效，此后无论在哪里直接使用acme.sh，不用输绝对路径</p>
<h1 id="由于最新acme-sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt"><a href="#由于最新acme-sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt" class="headerlink" title="由于最新acme.sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt"></a>由于最新acme.sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt</h1><p>acme.sh –set-default-ca –server letsencrypt<br>配置证书<br>获取Cloudflare api key<br>注册好cloudflare账号，把域名dns的解析权限交给cloudflare处理，这样以后只需要在cloudflare这里配置解析记录。按照图示获取cloudflare api key。</p>
<p>1</p>
<p>申请证书（二选一）<br>这里假定你的域名是yourdomain.com，执行下面命令申请证书：</p>
<p>dns方式验证<br>export CF_Key&#x3D;”slfjksjffjfhfhkjhfksjf” &#x2F;&#x2F;此处替换成你自己的Key<br>export CF_Email&#x3D;”<a href="mailto:&#121;&#111;&#x75;&#114;&#99;&#x6c;&#x6f;&#117;&#x64;&#102;&#x6c;&#x61;&#114;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#109;">&#121;&#111;&#x75;&#114;&#99;&#x6c;&#x6f;&#117;&#x64;&#102;&#x6c;&#x61;&#114;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#109;</a>“ &#x2F;&#x2F;此处填写你给Cloudflare绑定的邮箱账号</p>
<p>acme.sh –issue –dns dns_cf -d yourdomain.com -d <a target="_blank" rel="noopener" href="http://www.yourdomain.com/">www.yourdomain.com</a> -k ec-256<br>说明：Cloudflare现已不支持.tk .cf .ml等免费申请来的域名后缀使用此dns验证方式，付费域名才受支持，免费域名使用下面2.2.2方式。脚本申请到的证书和key都放在~&#x2F;.acme.sh&#x2F;yourdomain.com_ecc目录下。</p>
<p>http方式验证<br>执行下面命令前请保证你80端口没有被别的程序使用，如果有，kill掉，执行下面命令前需要你先在cloudflare dns那里添加好A记录，可以开启cloudflare cdn（cdn对此http方式验证无影响）：</p>
<p>acme.sh –issue –standalone -d yourdomain.com -d <a target="_blank" rel="noopener" href="http://www.yourdomain.com/">www.yourdomain.com</a> -k ec-256<br>说明：跟上面一样，脚本申请到的证书放在~&#x2F;.acme.sh&#x2F;yourdomain.com_ecc目录下</p>
<p>安装证书到指定位置<br>假定linux主机里已有&#x2F;root&#x2F;ssl目录，现在要把证书和key安装到此目录下，那么执行下面的命令即可：</p>
<p>acme.sh –installcert -d yourdomain.com -d <a target="_blank" rel="noopener" href="http://www.yourdomain.com/">www.yourdomain.com</a> –fullchain-file &#x2F;root&#x2F;ssl&#x2F;web.crt –key-file &#x2F;root&#x2F;ssl&#x2F;web.key –ecc<br>证书更新<br>从letscncrypt申请到的证书有效期是90天，但脚本会每60天会对证书进行更新，后续可能会缩短这个时间，都是自动的。</p>
<h1 id="手动强制更新证书"><a href="#手动强制更新证书" class="headerlink" title="手动强制更新证书"></a>手动强制更新证书</h1><p>acme.sh –renew -d yourdomain.com -d <a target="_blank" rel="noopener" href="http://www.yourdomain.com/">www.yourdomain.com</a> –force –ecc<br>局部API部份<br>本文主要以Debian10为例，介绍使用新的cloudflare api令牌来申请证书，免费域名已不受cloudflare此种方式来申请证书，请使用付费域名。</p>
<p>安装配置acme.sh脚本<br>以root用户ssh登陆到主机，使用下面命令安装配置脚本：</p>
<h1 id="更新源并安装socat"><a href="#更新源并安装socat" class="headerlink" title="更新源并安装socat"></a>更新源并安装socat</h1><p>apt update &amp;&amp; apt -y install socat</p>
<h1 id="安装脚本"><a href="#安装脚本" class="headerlink" title="安装脚本"></a>安装脚本</h1><p>wget -qO- get.acme.sh | bash</p>
<h1 id="让脚本在-bashrc文件追加的一行环境变量生效，以后无论在哪里直接使用acme-sh，不用输绝对路径"><a href="#让脚本在-bashrc文件追加的一行环境变量生效，以后无论在哪里直接使用acme-sh，不用输绝对路径" class="headerlink" title="让脚本在.bashrc文件追加的一行环境变量生效，以后无论在哪里直接使用acme.sh，不用输绝对路径"></a>让脚本在.bashrc文件追加的一行环境变量生效，以后无论在哪里直接使用acme.sh，不用输绝对路径</h1><p>source ~&#x2F;.bashrc</p>
<h1 id="由于最新acme-sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt-1"><a href="#由于最新acme-sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt-1" class="headerlink" title="由于最新acme.sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt"></a>由于最新acme.sh脚本默认ca变成了zerossl，现执行下面命令修改脚本默认ca为letsencrypt</h1><p>acme.sh –set-default-ca –server letsencrypt<br>配置Cloudflare局部令牌<br>创建令牌<br>根据acme.sh脚本作者提供的文档：使用新的cloudflare api令牌，需要新创建此令牌方可使用：</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>依照上述图片设置即可，添加区域-DNS-编辑和区域-区域-读取权限，区域资源里面选择包括-账户的所有区域-你的账户。</p>
<p>5</p>
<p>配置好以后，点击创建令牌，注意此令牌token只会出现一次，切记保存，切记保存，切记保存！！！</p>
<p>获取账户ID和区域ID<br>根据acme.sh文档，申请证书可能还需要提供两个ID，其中账户ID必须，区域ID可有可无，根据下图方法获取此两个ID：</p>
<p>6</p>
<p>下拉，找到API区域：</p>
<p>7</p>
<p>至此，即准备好了申请证书需要的材料：</p>
<h1 id="上面第一步创建的令牌，即为token"><a href="#上面第一步创建的令牌，即为token" class="headerlink" title="上面第一步创建的令牌，即为token"></a>上面第一步创建的令牌，即为token</h1><p>CF_Token&#x3D;”xxxxxxx”</p>
<h1 id="根据上图分别获取账户ID和区域ID"><a href="#根据上图分别获取账户ID和区域ID" class="headerlink" title="根据上图分别获取账户ID和区域ID"></a>根据上图分别获取账户ID和区域ID</h1><p>CF_Account_ID&#x3D;”aaaaaaaa”<br>CF_Zone_ID&#x3D;”bbbbbbbbb”   &#x2F;&#x2F;此项非必须<br>申请配置证书<br>申请证书<br>假定你的域名是example.com，执行下面命令申请证书，非root用户也可执行：</p>
<h1 id="执行此命令设置变量的值，acme-sh脚本执行过程会读取"><a href="#执行此命令设置变量的值，acme-sh脚本执行过程会读取" class="headerlink" title="执行此命令设置变量的值，acme.sh脚本执行过程会读取"></a>执行此命令设置变量的值，acme.sh脚本执行过程会读取</h1><p>export CF_Token&#x3D;”xxxxxxx”<br>export CF_Account_ID&#x3D;”aaaaaaa”<br>export CF_Zone_ID&#x3D;”bbbbbbbb”   &#x2F;&#x2F;此项非必须，上面两项需要提供</p>
<h1 id="申请证书"><a href="#申请证书" class="headerlink" title="申请证书"></a>申请证书</h1><p>acme.sh –issue -d example.com -d *.example.com –dns dns_cf -k ec-256<br>安装证书到指定位置<br>假定linux主机里已有&#x2F;etc&#x2F;ssl目录，现在要把证书和key安装到此目录下，那么执行下面的命令即可：</p>
<p>acme.sh –installcert -d example.com -d *.example.com –fullchain-file &#x2F;etc&#x2F;ssl&#x2F;web.crt –key-file &#x2F;etc&#x2F;ssl&#x2F;web.key –ecc</p>
<h1 id="用–reloadcmd指定安装证书后的命令"><a href="#用–reloadcmd指定安装证书后的命令" class="headerlink" title="用–reloadcmd指定安装证书后的命令"></a>用–reloadcmd指定安装证书后的命令</h1><p>acme.sh –installcert -d example.com -d *.example.com –fullchain-file &#x2F;etc&#x2F;ssl&#x2F;web.crt –key-file &#x2F;etc&#x2F;ssl&#x2F;web.key –ecc –reloadcmd “systemctl restart webserver”<br>说明：脚本更新完证书后，会自动依据上面指定的绝对路径将证书和key安装到指定位置，并根据–reloadcmd执行相应的操作。</p>
<p>证书更新<br>从letsencrypt申请到的证书有效期是90天，脚本每60天会对证书进行更新，你也可以手动强制更新：</p>
<h1 id="查询域名申请证书信息"><a href="#查询域名申请证书信息" class="headerlink" title="查询域名申请证书信息"></a>查询域名申请证书信息</h1><p>acme.sh –list</p>
<h1 id="手动强制更新证书-1"><a href="#手动强制更新证书-1" class="headerlink" title="手动强制更新证书"></a>手动强制更新证书</h1><p>acme.sh –renew -d example.com -d *.example.com –force –ecc<br>acme.sh –renew -d example.com -d *.example.com –force &#x2F;&#x2F;非ECC证书使用此命令</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mengbailuoli233.github.io/2024/03/17/My-New-Post/" data-id="cltutqwd600008cvz5m6fdh2t" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/03/17/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/17/My-New-Post/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/03/17/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 WeiBai<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>